<?xml version="1.0"?>

<Diamond application="spark" version="169" softwareVersion="1.0.2048.481">
    <Decoder name="GPRS Parser" type="ascii">
        <RecordType root="true" name="Root" type="none">
            <Logic type="sequenceOf">
                <Logic recordType="GprsRecord" type="recordReference"/>
            </Logic>
        </RecordType>
        <RecordType allowEOFTerm="false" parseDoubleQuotes="false" delimiter="comma" root="false" name="GprsRecord" tokens="33" terminator="crlf" type="delimitedascii" generate="record" parseQuotes="false">
            <Field name="EvtDttm" trimQuotes="true" trimWhiteSpace="true" id="0" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field">
                <FieldConverter format="dd/MM/yyyy HH:mm:ss" type="datetime"/>
            </Field>
            <Field name="EvtCount" trimQuotes="true" trimWhiteSpace="true" id="1" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field">
                <FieldConverter type="integer"/>
            </Field>
            <Field name="EvtUsage" trimQuotes="true" trimWhiteSpace="true" id="2" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field">
                <FieldConverter type="integer"/>
            </Field>
            <Field name="imsi" trimQuotes="true" trimWhiteSpace="true" id="3" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="msisdn" trimQuotes="true" trimWhiteSpace="true" id="4" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="min" trimQuotes="true" trimWhiteSpace="true" id="5" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="mdn" trimQuotes="true" trimWhiteSpace="true" id="6" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="pdpAddress" trimQuotes="true" trimWhiteSpace="true" id="7" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="networkAccessIdentifier" trimQuotes="true" trimWhiteSpace="true" id="8" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="gprsAccessPointNameNI" trimQuotes="true" trimWhiteSpace="true" id="9" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="gprsAccessPointNameOI" trimQuotes="true" trimWhiteSpace="true" id="10" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="causeforTermination" trimQuotes="true" trimWhiteSpace="true" id="11" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field">
                <FieldConverter type="integer"/>
            </Field>
            <Field name="recEntityId" trimQuotes="true" trimWhiteSpace="true" id="12" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="inSwitch" trimQuotes="true" trimWhiteSpace="true" id="13" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="outSwitch" trimQuotes="true" trimWhiteSpace="true" id="14" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="inRoute" trimQuotes="true" trimWhiteSpace="true" id="15" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="outRoute" trimQuotes="true" trimWhiteSpace="true" id="16" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="partialTypeIndicator" trimQuotes="true" trimWhiteSpace="true" id="17" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="pdpContextstartDttm" trimQuotes="true" trimWhiteSpace="true" id="18" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field">
                <FieldConverter format="dd/MM/yyyy HH:mm:ss" type="datetime"/>
            </Field>
            <Field name="networkInitPDPContext" trimQuotes="true" trimWhiteSpace="true" id="19" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field">
                <FieldConverter type="integer"/>
            </Field>
            <Field name="chargingId" trimQuotes="true" trimWhiteSpace="true" id="20" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field">
                <FieldConverter type="integer"/>
            </Field>
            <Field name="locationAreaCode" trimQuotes="true" trimWhiteSpace="true" id="21" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field">
                <FieldConverter type="integer"/>
            </Field>
            <Field name="cellIdentity" trimQuotes="true" trimWhiteSpace="true" id="22" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field">
                <FieldConverter type="integer"/>
            </Field>
            <Field name="homeBid" trimQuotes="true" trimWhiteSpace="true" id="23" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="homeLocationDesc" trimQuotes="true" trimWhiteSpace="true" id="24" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="servingNetwork" trimQuotes="true" trimWhiteSpace="true" id="25" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="servingBid" trimQuotes="true" trimWhiteSpace="true" id="26" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="servingLocationDesc" trimQuotes="true" trimWhiteSpace="true" id="27" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="imei" trimQuotes="true" trimWhiteSpace="true" id="28" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="esn" trimQuotes="true" trimWhiteSpace="true" id="29" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field"/>
            <Field name="iMSSignallingContext" trimQuotes="true" trimWhiteSpace="true" id="30" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field">
                <FieldConverter type="integer"/>
            </Field>
            <Field name="dataVolumeIncoming" trimQuotes="true" trimWhiteSpace="true" id="31" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field">
                <FieldConverter type="integer"/>
            </Field>
            <Field name="dataVolumeOutgoing" trimQuotes="true" trimWhiteSpace="true" id="32" trimWhiteSpaceInsideQuotes="true" type="string" encoding="windows-1252" generate="field">
                <FieldConverter type="integer"/>
            </Field>
        </RecordType>
    </Decoder>
    <Mappings>
        <Nodes>
            <Node yPos="95" recordType="GprsRecord" width="115" name="Gprs record" nodeKey="shape1" xPos="60" type="Record" height="50">
                <Inputs/>
                <Outputs>
                    <Output name="Output"/>
                </Outputs>
            </Node>
            <Node yPos="90" recordType="gprs_event" width="60" name="Gprs Mapping" nodeKey="shape2" xPos="385" type="Mapping" height="60">
                <Inputs>
                    <Input nodeOutput="Output" nodeKey="shape1">
                        <Events/>
                    </Input>
                </Inputs>
                <Outputs>
                    <Output name="Output">
                        <Events/>
                    </Output>
                </Outputs>
                <Mappings>
                    <Mapping expression="$$StreamFileId" target="sfl_id"/>
                    <Mapping expression="$$StreamStageId" target="sts_id"/>
                    <Mapping expression="imsi" target="imsi"/>
                    <Mapping expression="msisdn" target="msisdn"/>
                    <Mapping expression="mdn" target="mdn"/>
                    <Mapping expression="pdpAddress" target="pdpAddress"/>
                    <Mapping expression="networkAccessIdentifier" target="networkAccessIdentifier"/>
                    <Mapping expression="gprsAccessPointNameNI" target="gprsAccessPointNameNI"/>
                    <Mapping expression="gprsAccessPointNameOI" target="gprsAccessPointNameOI"/>
                    <Mapping expression="partialTypeIndicator" target="partialTypeIndicator"/>
                    <Mapping expression="chargingId" target="chargingId"/>
                    <Mapping expression="homeBid" target="homeBid"/>
                    <Mapping expression="servingNetwork" target="servingNetwork"/>
                    <Mapping expression="servingBid" target="servingBid"/>
                    <Mapping expression="imei" target="imei"/>
                    <Mapping expression="esn" target="esn"/>
                    <Mapping expression="iMSSignallingContext" target="iMSSignallingContext"/>
                    <Mapping expression="dataVolumeIncoming" target="dataVolumeIncoming"/>
                    <Mapping expression="dataVolumeOutgoing" target="dataVolumeOutgoing"/>
                    <Mapping expression="GetEventId()" target="gps_id"/>
                    <Mapping expression="EvtDttm" target="gps_dttm"/>
                    <Mapping expression="$$StreamId" target="stm_id"/>
                    <Mapping expression="$$TaskId" target="tsk_id"/>
                    <Mapping expression="min" target="gprs_min"/>
                    <Mapping target="callEventStartUtcCode"/>
                    <Mapping expression="ToString(EvtDttm, 'CCYYMMddHHmmss')" target="callEventStartDttmLocal"/>
                    <Mapping expression="EvtUsage" target="totalCallEventDuration"/>
                    <Mapping expression="causeforTermination" target="causeForTerm"/>
                    <Mapping expression="ToString(pdpContextstartDttm, 'CCYYMMddHHmmss')" target="pDPContextStartDttmLocal"/>
                    <Mapping expression="networkInitPDPContext" target="networkInitPDPContext"/>
                    <Mapping expression="'GPRS'" target="eventType"/>
                    <Mapping expression="servingLocationDesc" target="servingLocationDescription"/>
                    <Mapping expression="homeLocationDesc" target="homeLocationDescription"/>
                    <Mapping expression="cellIdentity" target="cellId"/>
                    <Mapping expression="locationAreaCode" target="locationArea"/>
                </Mappings>
            </Node>
            <Node charset="windows-1252" filename="Concatenate( $$Filename, '_', ToString( Now(), 'yyyyMMdd_HHmmss' ), '_', $$UsagePartitionId, '_', $$FileRecords, '.dat' )" yPos="95" outputKey="GprsEvent" width="80" name="GprsEvent" unicode="false" nodeKey="shape3" xPos="670" type="SparkOutput" height="50">
                <Inputs>
                    <Input nodeOutput="Output" nodeKey="shape2"/>
                </Inputs>
                <Outputs/>
            </Node>
            <Node yPos="245" recordType="tap_event" width="60" name="Tap Event Mapping" nodeKey="shape4" xPos="385" type="Mapping" height="60">
                <Inputs>
                    <Input nodeOutput="Output" nodeKey="shape2">
                        <Events/>
                    </Input>
                </Inputs>
                <Outputs>
                    <Output name="Output">
                        <Events/>
                    </Output>
                </Outputs>
                <Mappings>
                    <Mapping expression="stm_id" target="stm_id"/>
                    <Mapping expression="tsk_id" target="tsk_id"/>
                    <Mapping expression="sfl_id" target="sfl_id"/>
                    <Mapping expression="$$RecordNumber" target="tap_record_number"/>
                    <Mapping expression="$$RecordAddress" target="tap_record_address"/>
                    <Mapping expression="$$RecordLength" target="tap_record_length"/>
                    <Mapping expression="$$RecordType" target="tap_record_type"/>
                    <Mapping expression="GetTapEventId()" target="evt_id"/>
                    <Mapping expression="gps_dttm" target="evt_dttm"/>
                    <Mapping expression="1" target="evt_count"/>
                    <Mapping expression="totalCallEventDuration" target="evt_usage"/>
                    <Mapping expression="$$Filename" target="tap_file_name"/>
                    <Mapping target="tap_sender"/>
                    <Mapping target="tap_recipient"/>
                    <Mapping expression="'GPRS'" target="tap_event_type"/>
                    <Mapping expression="'GPRS'" target="tap_rec_type_name"/>
                    <Mapping target="tap_local_currency"/>
                    <Mapping expression="ToString(chargingId)" target="tap_charging_id"/>
                    <Mapping expression="imsi" target="tap_imsi"/>
                    <Mapping expression="msisdn" target="tap_msisdn"/>
                    <Mapping target="tap_called_number"/>
                    <Mapping target="tap_service_code"/>
                    <Mapping target="tap_charge_time_stamp"/>
                    <Mapping target="tap_charged_item"/>
                    <Mapping target="tap_charge"/>
                    <Mapping expression="pdpAddress" target="tap_pdp_address"/>
                    <Mapping expression="Now()" target="tap_parse_date_time"/>
                    <Mapping expression="accessPointNameNI" target="tap_gprs_destination"/>
                    <Mapping expression="gps_id" target="rec_id"/>
                    <Mapping expression="$GprsTinId" target="tin_id"/>
                    <Mapping target="thd_id"/>
                    <Mapping target="tap_decimal_places"/>
                    <Mapping expression="HourOfDay(gps_dttm)" target="tap_hour_of_day"/>
                    <Mapping expression="locationArea" target="tap_location"/>
                    <Mapping target="tap_message_desc"/>
                </Mappings>
            </Node>
            <Node charset="windows-1252" filename="Concatenate( $$Filename, '_', ToString( Now(), 'yyyyMMdd_HHmmss' ), '_', $$UsagePartitionId, '_', $$FileRecords, '.dat' )" yPos="250" outputKey="Tap Event" UsagePartitionId="GetUsagePartitionId(evt_dttm, SecondPart(evt_dttm))" width="75" name="Tap Event" unicode="false" nodeKey="shape5" xPos="675" type="SparkOutput" height="50">
                <Inputs>
                    <Input nodeOutput="Output" nodeKey="shape4">
                        <Events/>
                    </Input>
                </Inputs>
                <Outputs/>
            </Node>
        </Nodes>
        <DynamicFunctions>
            <DynamicFunction objectKey="GprsEvent" name="GetEventId" type="GenerateLongId" blockSize="10000"/>
            <DynamicFunction objectKey="TapEvent" name="GetTapEventId" type="GenerateLongId" blockSize="10000"/>
            <DynamicFunction name="TableInst" type="SQLKeyCacheLookup" allowDuplicates="true" tableName="table_inst">
                <LookupKeys>
                    <LookupKey key="tin_table_name"/>
                </LookupKeys>
                <ResultCols>
                    <ResultCol duplicates="false" name="tin_id"/>
                </ResultCols>
            </DynamicFunction>
        </DynamicFunctions>
        <RecordTypes>
            <RecordType name="gprs_event">
                <Field nullable="false" name="gps_id" id="33" type="integer"/>
                <Field nullable="false" name="gps_dttm" id="34" type="datetime"/>
                <Field nullable="false" name="stm_id" id="35" type="integer"/>
                <Field nullable="false" name="tsk_id" id="36" type="integer"/>
                <Field nullable="false" name="sfl_id" id="37" type="integer"/>
                <Field nullable="false" name="sts_id" id="38" type="integer"/>
                <Field nullable="true" name="imsi" id="3" type="string"/>
                <Field nullable="true" name="msisdn" id="4" type="string"/>
                <Field nullable="true" name="gprs_min" id="39" type="string"/>
                <Field nullable="true" name="mdn" id="6" type="string"/>
                <Field nullable="true" name="rapFileSequenceNumber" id="40" type="string"/>
                <Field nullable="true" name="pdpAddress" id="7" type="string"/>
                <Field nullable="true" name="networkAccessIdentifier" id="8" type="string"/>
                <Field nullable="true" name="callEventStartDttmLocal" id="41" type="string"/>
                <Field nullable="true" name="callEventStartUtcCode" id="42" type="integer"/>
                <Field nullable="true" name="gprsAccessPointNameNI" id="9" type="string"/>
                <Field nullable="true" name="gprsAccessPointNameOI" id="10" type="string"/>
                <Field nullable="true" name="totalCallEventDuration" id="43" type="integer"/>
                <Field nullable="true" name="causeForTerm" id="44" type="integer"/>
                <Field nullable="true" name="partialTypeIndicator" id="17" type="string"/>
                <Field nullable="true" name="pDPContextStartDttmLocal" id="45" type="string"/>
                <Field nullable="true" name="pDPContextStartDttmUtcCode" id="46" type="integer"/>
                <Field nullable="true" name="networkInitPDPContext" id="19" type="integer"/>
                <Field nullable="true" name="chargingId" id="20" type="integer"/>
                <Field nullable="true" name="locationArea" id="47" type="integer"/>
                <Field nullable="true" name="cellId" id="48" type="integer"/>
                <Field nullable="true" name="homeBid" id="23" type="string"/>
                <Field nullable="true" name="homeLocationDescription" id="49" type="string"/>
                <Field nullable="true" name="servingNetwork" id="25" type="string"/>
                <Field nullable="true" name="servingBid" id="26" type="string"/>
                <Field nullable="true" name="servingLocationDescription" id="50" type="string"/>
                <Field nullable="true" name="imei" id="28" type="string"/>
                <Field nullable="true" name="esn" id="29" type="string"/>
                <Field nullable="true" name="iMSSignallingContext" id="30" type="integer"/>
                <Field nullable="true" name="dataVolumeIncoming" id="31" type="integer"/>
                <Field nullable="true" name="dataVolumeOutgoing" id="32" type="integer"/>
                <Field nullable="true" name="camelServiceLevel" id="51" type="integer"/>
                <Field nullable="true" name="camelServiceKey" id="52" type="integer"/>
                <Field nullable="true" name="defaultCallHandling" id="53" type="integer"/>
                <Field nullable="true" name="exchangeRateCode" id="54" type="integer"/>
                <Field nullable="true" name="discountCode" id="55" type="integer"/>
                <Field nullable="true" name="discount" id="56" type="integer"/>
                <Field nullable="true" name="discountableAmount" id="57" type="integer"/>
                <Field nullable="true" name="camelInvocationFee" id="58" type="integer"/>
                <Field nullable="true" name="camelDestinationNumber" id="59" type="string"/>
                <Field nullable="true" name="accessPointNameNI" id="60" type="string"/>
                <Field nullable="true" name="accessPointNameOI" id="61" type="string"/>
                <Field nullable="true" name="cseInformation" id="62" type="string"/>
                <Field nullable="true" name="eventType" id="63" type="string"/>
            </RecordType>
            <RecordType name="tap_event">
                <Field nullable="false" name="evt_id" id="64" type="integer"/>
                <Field nullable="false" name="evt_dttm" id="65" type="datetime"/>
                <Field nullable="false" name="evt_count" id="66" type="integer"/>
                <Field nullable="false" name="evt_usage" id="67" type="integer"/>
                <Field nullable="false" name="stm_id" id="35" type="integer"/>
                <Field nullable="false" name="tsk_id" id="36" type="integer"/>
                <Field nullable="false" name="sfl_id" id="37" type="integer"/>
                <Field nullable="false" name="tap_file_name" id="68" type="string"/>
                <Field nullable="true" name="tap_sender" id="69" type="string"/>
                <Field nullable="true" name="tap_recipient" id="70" type="string"/>
                <Field nullable="false" name="tap_event_type" id="71" type="string"/>
                <Field nullable="false" name="tap_rec_type_name" id="72" type="string"/>
                <Field nullable="true" name="tap_imsi" id="73" type="string"/>
                <Field nullable="true" name="tap_msisdn" id="74" type="string"/>
                <Field nullable="true" name="tap_called_number" id="75" type="string"/>
                <Field nullable="true" name="tap_dialed_digits" id="76" type="string"/>
                <Field nullable="true" name="tap_service_code" id="77" type="integer"/>
                <Field nullable="true" name="tap_location" id="78" type="integer"/>
                <Field nullable="true" name="tap_pdp_address" id="79" type="string"/>
                <Field nullable="true" name="tap_gprs_destination" id="80" type="string"/>
                <Field nullable="true" name="tap_rec_entity_type" id="81" type="string"/>
                <Field nullable="true" name="tap_message_desc" id="82" type="string"/>
                <Field nullable="false" name="tap_hour_of_day" id="83" type="integer"/>
                <Field nullable="false" name="tap_parse_date_time" id="84" type="datetime"/>
                <Field nullable="false" name="rec_id" id="85" type="integer"/>
                <Field nullable="false" name="tin_id" id="86" type="integer"/>
                <Field nullable="true" name="thd_id" id="87" type="integer"/>
            </RecordType>
        </RecordTypes>
        <Globals>
            <Global name="GprsTinId" id="0" type="integer" serializable="false" initialValue="TableInst_tin_id('gprs_event')"/>
        </Globals>
    </Mappings>
</Diamond>
